services:
  nyaproxy:
    build:
      context: .
      dockerfile: Dockerfile
    image: nyaproxy:latest
    container_name: nyaproxy
    restart: unless-stopped
    ports:
      # Notes: change the host port if conflicting
      - "8080:8080"
    volumes:
      - ./config.yaml:/app/config.yaml
      - logs:/app/logs
    environment:
      # Notes: CONFIG_PATH only supports relative paths
      - CONFIG_PATH=config.yaml
      # Optional: performance boost (safe to ignore if unsupported)
      - DOCKER_BUILDKIT=1
      - COMPOSE_DOCKER_CLI_BUILD=1
    networks:
      - nyaproxy-network
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M

networks:
  nyaproxy-network:
    driver: bridge
    driver_opts:
      # Avoid naming conflicts; optional, WSL-safe
      com.docker.network.bridge.name: nyaproxy-br

volumes:
  logs:
    driver: local
    # Use cross-platform path expansion
    driver_opts:
      type: none
      device: ${PWD}/logs
      o: bind
